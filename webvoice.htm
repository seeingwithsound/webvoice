<!-- All rights are reserved. Reproduction in whole or in part is   -->
<!-- prohibited without the written consent of the copyright owner. -->
<!-- (C) P.B.L. Meijer 2015 - 2018 -->
<!DOCTYPE HTML>
<HTML>
<HEAD>
<META NAME="mobile-web-app-capable" CONTENT="yes" />
<META NAME="apple-mobile-web-app-capable" CONTENT="yes" />
<META NAME="apple-mobile-web-app-status-bar-style" CONTENT="black" />
<META NAME="msapplication-TileImage" CONTENT="logo_144.png" />
<LINK REL="icon" TYPE="image/png" SIZES="128x128" HREF="logo_128.png" />
<LINK REL="icon" TYPE="image/png" SIZES="144x144" HREF="logo_144.png" />
<LINK REL="icon" TYPE="image/png" SIZES="192x192" HREF="logo_192.png" />
<LINK REL="apple-touch-icon" SIZES="128x128" HREF="logo_128.png" />
<LINK REL="apple-touch-icon" SIZES="144x144" HREF="logo_144.png" />
<LINK REL="apple-touch-icon" SIZES="180x180" HREF="logo_180.png" />
<LINK REL="manifest" HREF="manifest.json" />
<META HTTP-EQUIV=Content-Type CONTENT="text/html; CHARSET=UTF-8" />
<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache, no-store, must-revalidate" />
<META HTTP-EQUIV="Pragma" CONTENT="no-cache" />
<META HTTP-EQUIV="Expires" CONTENT="0" />
<!--
<LINK REL=STYLESHEET HREF="../head.css" />
<SCRIPT SRC="../head.js" TYPE="text/javascript"></SCRIPT>
-->
<TITLE>The vOICe web app</TITLE>
<META NAME="viewport" CONTENT="width=device-width, initial-scale=1.0" />
<SCRIPT>
<!--
document.write("<LINK HREF='"+location.href.substring(location.href.lastIndexOf("/")+1,location.href.lastIndexOf(".")+1)+"css' REL='stylesheet' TYPE='text/css'/>");
// Avoid race condition for loading CSS for setting background-color etc with Firefox on Android?
// var getcss = document.createElement("getcss");
// getcss.innerHTML = "<LINK HREF='"+location.href.substring(location.href.lastIndexOf("/")+1,location.href.lastIndexOf(".")+1)+"css' REL='stylesheet' TYPE='text/css'/>";
// document.head.appendChild(getcss);
var cacheVersion = null;
//navigator.storage.estimate().then(function(info) { 
//console.log(info.quota);
//console.log(info.usage);
//});
function updateDiv() {
   setTimeout(function() { 
      var existDiv = document.getElementById('cacheDiv');  // Deal with race condition (div may not exist yet)
      if (existDiv && cacheVersion) document.getElementById('cacheDiv').innerHTML = cacheVersion.substring(0,cacheVersion.indexOf('.')+3);
   }, 2000);
}
if ('serviceWorker' in navigator) {
// document.addEventListener('DOMContentLoaded', function() {  // Wait with registration until page has loaded and cacheDiv exists
// window.addEventListener('load', function() {  // Wait with registration until page has loaded and cacheDiv exists
   navigator.serviceWorker.register('./sw.js')
   .then(function(reg) {
      console.log('Service worker registered. Scope is ' + reg.scope);
      navigator.serviceWorker.addEventListener('message', function(event) {
         cacheVersion = `${event.data}`;
         console.log('The vOICe web app version '+cacheVersion);
         updateDiv();
      });
   }).catch(function(error) {
      console.log('Service worker registration failed with ' + error);
   });
// });
}
// -->
</SCRIPT>
</HEAD>
<!-- onunload for Safari https://stackoverflow.com/questions/3602887/why-doesnt-safari-honor-my-cache-control-directive -->
<BODY onunload="" onload="updateDiv();" BGCOLOR="#000000" TEXT="#ffffff" LINK="#ffff00" VLINK="#ffff00" ALINK="#ff0000">
<font face="Arial,Helvetica,sans-serif">

<div align=right><font size=1>
<a href="webvoice.htm?hl=en" title="English">en</a> 
| <a href="webvoice.htm?hl=ru" title="русский">ru</a> 
| <a href="webvoice.htm?hl=cn" title="中国">cn</a>
| <a href="webvoice.htm?hl=jp" title="日本人">jp</a>
&nbsp;
</font></div>

<SCRIPT>
<!--
function rc(ccode) {
   if (location.protocol != "file:" && top.document.referrer && top.document.referrer.toLowerCase().indexOf(ccode) != -1) return true; else return false;
}
var hl = "";
if (navigator.userLanguage) hl = navigator.userLanguage.toLowerCase().substr(0,2); // IE 4+
else if (navigator.language) hl = navigator.language.toLowerCase().substr(0,2); // NS
var xcy = (hl == "ru" || hl == "uk");
var xcn = (hl == "cn");
var xjp = (hl == "jp");
if (rc(".ru/") || rc(".ua/") || rc(".su/") || rc(".kz/") || rc(".by/") || rc(".az/") || rc(".bg/") || rc(".kg/")) xcy = true;
if (rc(".cn/")) xcn = true;
if (rc(".jp/")) xjp = true;
function getQueryString(name, url) {
   if (!url) url = window.location.href;
   name = name.replace(/[\[\]]/g, '\\$&');
   var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'), results = regex.exec(url);
   if (!results) return null;
   if (!results[2]) return '';
   return decodeURIComponent(results[2].replace(/\+/g, ' '));
}
hl = getQueryString("hl"); 
if (hl != null) { 
   xcy = (hl == "ru" || hl == "uk");
   xcn = (hl == "cn");
   xjp = (hl == "jp");
}
var qvr          = (getQueryString("vr") != null);
var qlarge       = (getQueryString("large") != null);
var qcataracts   = (getQueryString("cataracts") != null);
var qhemianopiaL = (getQueryString("hemianopia") != null || getQueryString("hemianopiaL") != null);
var qhemianopiaR = (getQueryString("hemianopiaR") != null);
//xcy = true;
//xcn = true;
//xjp = true;
if (xcy) document.write(
"<Center><H1>The vOICe для веб</H1></Center>"+
"<Center><H3>сенсорного замещения<BR>"+
"в вашем браузере</H3></Center>");
else if (xcn) document.write(
"<Center><H1>The vOICe 网络应用</H1></Center>"+
"<Center><H1>用你的耳朵看！</H1></Center>");
else if (xjp) document.write(
"<Center><H1>The vOICe ェブアプリ</H1></Center>"+
"<Center><H1>耳で見て！</H1></Center>");
else document.write(
"<Center><H1>The vOICe web app</H1></Center>"+
"<Center><H3>sensory substitution app<BR>"+
"runs inside your browser</H3></Center>");
// -->
</SCRIPT>
<!--
<Center><H1>The vOICe web app</H1></Center>
<Center><H3>sensory substitution app<BR>
runs inside your browser</H3></Center><P>
-->
<Center>
<NOSCRIPT>
<P><font color="#ffff00" size=4><b>### Javascript must be enabled! ###</b></font></P>
</NOSCRIPT>
<form><font size=-1><span id="viewSpan">view:</span>
<!--
<input type="checkbox" id="gxScanline"/><label for="gxScanline">scan</label>
<input type="checkbox" id="gxScale"/><label for="gxScale">large</label>
<input type="checkbox" id="gxHDR"/><label for="gxHDR">HDR</label>
<input type="checkbox" id="gxVR"/><label for="gxVR">VR</label>
-->
<label><input type="checkbox" id="gxScanline"/>scan</label>
<label><input type="checkbox" id="gxScale"/>large</label>
<label><input type="checkbox" id="gxHDR"/>HDR</label>
<label><input type="checkbox" id="gxVR"/>VR</label>
</font></form>
<table width=176 cellpadding=0 cellspacing=0 border=0><tr><td><Center>
<div class="select" id="gxSource"><font size=-1><label for="videoSourceID">video source: </label></font><select id="videoSourceID"></select></div>
<div class="select" id="gxScanRate"><font size=-1><label for="scanRateID">scan rate: </label></font><select id="scanRateID"></select></div>
<div id="gxArea" STYLE="z-index:0;">
<video id="gxVideo" playsinline autoplay></video><!-- Chrome on Android needs autoplay -->
<canvas id="gxCanvas" style="border:none;"></canvas>
</div>
</Center></td></tr></table>
<div class="buttonwrapper">
<button id="gxMute" accesskey="m">mute</button>
<button id="gxEdges" accesskey="e">edges</button>
<button id="gxNegative" accesskey="n">negative</button>
<button id="gxZoom" accesskey="z">zoom</button>
<button id="gxMono" accesskey="s">mono</button>
<button id="gxTorch" accesskey="t">torch</button>
<button id="gxReset" accesskey="r">reset</button>
<button id="gxRecord" accesskey="q">record</button>
</div>
<div id="gxStatus"></div>

<SCRIPT>
<!--
if (window.self !== window.top) window.top.location.href=window.location.href;  // No frames
// https://stackoverflow.com/questions/8788802/prevent-safari-loading-from-cache-when-back-button-is-clicked
// window.onpageshow = function (event) { if (event.persisted) { window.location.reload(); }};
document.write("<script src='"+location.href.substring(location.href.lastIndexOf("/")+1,location.href.lastIndexOf("."))+"_i.js'><\/script>");
document.write("<script src='"+location.href.substring(location.href.lastIndexOf("/")+1,location.href.lastIndexOf(".")+1)+"js'><\/script>");
if (xcy) document.write("<P>The vOICe веб приложение для слепых</P>");
else if (xcn) document.write("<P>盲的人提供增强现实</P>");
else if (xjp) document.write("<P>視覚障害者のための拡張現実</P>");
else document.write("<P>The vOICe web app for the totally blind<BR>requires browser with WebRTC support</P>");
// -->
</SCRIPT>

<P><div id="gxMessage"></div>

<!--<P><A HREF="webvoice2.htm">usage notes</A> | <A HREF="../index.html" TARGET="_top">The vOICe homepage</A></P>-->

<SCRIPT>
<!--
if (xcy) document.write("<P><A HREF='webvoice2.htm'>заметки</A> (en)&#160;&#160;|&#160; <A HREF='../index.html' TARGET='_top'>The vOICe главная</A></P>");
else if (xcn) document.write("<P><A HREF='webvoice2.htm'>使用说明</A> (en)&#160;&#160;|&#160; <A HREF='../index.html' TARGET='_top'>The vOICe 主页</A></P>");
else if (xjp) document.write("<P><A HREF='webvoice2.htm'>ノート</A> (en)&#160;&#160;|&#160; <A HREF='../index.html' TARGET='_top'>The vOICe </A></P>");
else document.write("<P><A HREF='webvoice2.htm'>usage notes</A>&#160;&#160;|&#160; <A HREF='../index.html' TARGET='_top'>The vOICe homepage</A></P>");
// Deal with race condition for div creation vs cacheVersion assignment (differs for Firefox and Chrome)
document.write("<font size=1 color=#7f7f7f><span id='versionSpan'>version</span> <div id='cacheDiv' style='display: inline-block'> <span id='unknownSpan'>"+(cacheVersion?cacheVersion.substring(0,cacheVersion.indexOf('.')+3):"unknown")+"</span></div></font>");
// -->
</SCRIPT>
<!--<P><font size=1 color=#7f7f7f>version <div id='cacheDiv' style='display: inline-block'>unknown</div></font><P>-->

</Center>
<!--<SCRIPT SRC="../ga.js" TYPE="text/javascript"></SCRIPT>-->
</font>
</BODY>
</HTML>
